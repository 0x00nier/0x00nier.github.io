<!DOCTYPE html>
<html lang=" en-US">

<head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- <meta name="viewport" content="width=device-width, initial-scale=0.5"> -->
  <meta name="viewport" content="width=device-width, initial-scale=0.5, minimum-scale=0.5, maximum-scale=0.5">
  <link rel="stylesheet" href="/assets/css/style.css?v=">
  <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup theme-color -->
<!-- start theme color meta headers -->
<meta name="theme-color" content="#151515">
<meta name="msapplication-navbutton-color" content="#151515">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- end theme color meta headers -->


<!-- Setup Google Analytics -->
<html>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4BJGEL04W9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4BJGEL04W9');
</script>

</html>


<!-- You can set your favicon here -->

<!-- end custom head snippets -->

  <title>Rokos Replicant</title>

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>0x00nier | Rokos Replicant</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="0x00nier" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Rokos Replicant" />
<meta property="og:description" content="Rokos Replicant" />
<link rel="canonical" href="http://localhost:4000/blogs/htb/bombslanded/bombslanded.html" />
<meta property="og:url" content="http://localhost:4000/blogs/htb/bombslanded/bombslanded.html" />
<meta property="og:site_name" content="0x00nier" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="0x00nier" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Rokos Replicant","headline":"0x00nier","url":"http://localhost:4000/blogs/htb/bombslanded/bombslanded.html"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>

  <header>
    <div class="container">
      <a id="a-title" href="/">
        <h1>0x00nier</h1>
      </a>

      <a id="a-title" href="../../../../../../../../../blogs.html" style="text-decoration:none">
        <h1 style="font-size: 18px;float:right;margin-top: -40px; margin-right: 5px;">writeups/</h1>
      </a>

      <a id="a-title" href="../../../../../../../../../experience.html" style="text-decoration:none">
        <h1 style="font-size: 18px;float:right;margin-top: -40px; margin-right: 120px;">xp/</h1>
      </a>

      <a id="a-title" href="../../../../../../../../../aboutme.html" style="text-decoration:none">
        <h1 style="font-size: 18px; float:right;margin-top: -40px;margin-right: 175px;">whoami/</h1>
      </a>
    </div>
  </header>

  <div class="container">
    <section id="main_content">
      <h1 id="bombs-landed--reversing-challenge--hackthebox-writeup">Bombs Landed — Reversing Challenge — HackTheBox Writeup</h1>

<p>Greetings everyone. In this write-up, I’ll be tackling the <code class="language-plaintext highlighter-rouge">Bombs Landed</code> challenge — my first time dealing with a medium-level (50 points) reversing challenge. I’m excited to share what I’ve learned and fill in the gaps since there are no detailed write-ups available. However, I won’t be giving away the flag directly. Instead, I’ll do my best to provide a comprehensive understanding of the challenge while still keeping things engaging.</p>

<p>Here’s the challenge prompt -</p>

<p><img src="./img/chal.webp" alt="" /></p>

<p>We’re on the hunt for the hidden password in the binary. Let’s begin.</p>

<h2 id="initial-analysis">Initial Analysis</h2>

<p>Let’s try to run this program.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/mnt/H/Misc <span class="o">&gt;</span> ./BombsLanded                                                                    
Bad luck dude.
/mnt/H/Misc <span class="o">&gt;</span> ./BombsLanded 1                                                                  
Bad luck dude.
/mnt/H/Misc <span class="o">&gt;</span> ./BombsLanded 1 2                                                                
Bad luck dude.
/mnt/H/Misc <span class="o">&gt;</span> ./BombsLanded 1 2 3                                                              
input password: itworked 
Bad luck dude.
</code></pre></div></div>

<p>Running the binary as is only results in the message <code class="language-plaintext highlighter-rouge">Bad luck dude.</code> being displayed, with no opportunity for input. However, after some experimentation, we discover that the binary requires at least three arguments. This will become clearer in the decompilation process. When we run the binary with the correct number of arguments, it prompts for a password but, as expected, our initial attempt is met with <code class="language-plaintext highlighter-rouge">Bad luck dude.</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/mnt/H/Misc <span class="o">&gt;</span> file BombsLanded                                                                 
BombsLanded: ELF 32-bit LSB executable, Intel 80386, version 1 <span class="o">(</span>SYSV<span class="o">)</span>, <span class="k">for </span>GNU/Linux 2.6.32, BuildID[sha1]<span class="o">=</span>53d6c985990fd9b8ed4f1caf10ce7d64e14b2121, dynamically linked, interpreter /lib/ld-linux.so.2, no section header
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">file</code> command reveals that this binary is a 32-bit, dynamically linked executable with no section headers. This makes things tricky, as the lack of clear boundaries between the <code class="language-plaintext highlighter-rouge">.data</code>, <code class="language-plaintext highlighter-rouge">.text</code>, and <code class="language-plaintext highlighter-rouge">.rodata</code> sections complicate understanding the binary’s structure and functions. And, with symbols and code sections resolved during runtime, reverse engineering the binary is going to require a little extra effort.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/mnt/H/Misc <span class="o">&gt;</span> readelf <span class="nt">-s</span> BombsLanded                                                           

Dynamic symbol information is not available <span class="k">for </span>displaying symbols.
/mnt/H/Misc <span class="o">&gt;</span> readelf <span class="nt">--dynamic</span> BombsLanded                                                    

Dynamic section at offset 0x1010 contains 29 entries:
  Tag        Type                         Name/Value
 0x00000001 <span class="o">(</span>NEEDED<span class="o">)</span>                     Shared library: <span class="o">[</span>libdl.so.2]
 0x00000001 <span class="o">(</span>NEEDED<span class="o">)</span>                     Shared library: <span class="o">[</span>libc.so.6]
 0x0000000c <span class="o">(</span>INIT<span class="o">)</span>                       0x8048670
 0x0000000d <span class="o">(</span>FINI<span class="o">)</span>                       0x8048c54
 0x00000019 <span class="o">(</span>INIT_ARRAY<span class="o">)</span>                 0x8049000
 0x0000001b <span class="o">(</span>INIT_ARRAYSZ<span class="o">)</span>               8 <span class="o">(</span>bytes<span class="o">)</span>
 0x0000001a <span class="o">(</span>FINI_ARRAY<span class="o">)</span>                 0x8049008
 0x0000001c <span class="o">(</span>FINI_ARRAYSZ<span class="o">)</span>               4 <span class="o">(</span>bytes<span class="o">)</span>
 0x6ffffef5 <span class="o">(</span>GNU_HASH<span class="o">)</span>                   0x804818c
 0x00000005 <span class="o">(</span>STRTAB<span class="o">)</span>                     0x8048318
 0x00000006 <span class="o">(</span>SYMTAB<span class="o">)</span>                     0x80481b8
 0x0000000a <span class="o">(</span>STRSZ<span class="o">)</span>                      283 <span class="o">(</span>bytes<span class="o">)</span>
 0x0000000b <span class="o">(</span>SYMENT<span class="o">)</span>                     16 <span class="o">(</span>bytes<span class="o">)</span>
 0x00000015 <span class="o">(</span>DEBUG<span class="o">)</span>                      0x0
 0x00000003 <span class="o">(</span>PLTGOT<span class="o">)</span>                     0x8049130
 0x00000002 <span class="o">(</span>PLTRELSZ<span class="o">)</span>                   104 <span class="o">(</span>bytes<span class="o">)</span>
 0x00000014 <span class="o">(</span>PLTREL<span class="o">)</span>                     REL
 0x00000017 <span class="o">(</span>JMPREL<span class="o">)</span>                     0x8048608
 0x00000011 <span class="o">(</span>REL<span class="o">)</span>                        0x80484c0
 0x00000012 <span class="o">(</span>RELSZ<span class="o">)</span>                      328 <span class="o">(</span>bytes<span class="o">)</span>
 0x00000013 <span class="o">(</span>RELENT<span class="o">)</span>                     8 <span class="o">(</span>bytes<span class="o">)</span>
 0x00000016 <span class="o">(</span>TEXTREL<span class="o">)</span>                    0x0
 0x0000001e <span class="o">(</span>FLAGS<span class="o">)</span>                      TEXTREL
 0x6ffffffb <span class="o">(</span>FLAGS_1<span class="o">)</span>                    Flags: PIE
 0x6ffffffe <span class="o">(</span>VERNEED<span class="o">)</span>                    0x8048460
 0x6fffffff <span class="o">(</span>VERNEEDNUM<span class="o">)</span>                 2
 0x6ffffff0 <span class="o">(</span>VERSYM<span class="o">)</span>                     0x8048434
 0x6ffffffa <span class="o">(</span>RELCOUNT<span class="o">)</span>                   18
 0x00000000 <span class="o">(</span>NULL<span class="o">)</span>                       0x0
</code></pre></div></div>

<p>As we can see, the only information we can retrieve is about the dynamic section of the binary. The dynamic section shows that the binary has an initialization and finalization function, as the <code class="language-plaintext highlighter-rouge">INIT</code> and <code class="language-plaintext highlighter-rouge">FINI</code> entries have absolute addresses at the very least.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/mnt/H/Misc <span class="o">&gt;</span> checksec BombsLanded                                                             
<span class="o">[!]</span> Did not find any GOT entries
<span class="o">[</span><span class="k">*</span><span class="o">]</span> <span class="s1">'/mnt/HackingUnixBinariesStuff/Misc/BombsLanded'</span>
    Arch:     i386-32-little
    RELRO:    No RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE <span class="o">(</span>0x8048000<span class="o">)</span>
    RWX:      Has RWX segments
</code></pre></div></div>

<p>Another helpful aspect is that the binary doesn’t have Position Independent Executable (PIE) enabled. This is evident from the use of absolute addresses in the dynamic section of the binary. This makes our reverse engineering journey a bit smoother, as we don’t have to worry about dealing with address relocations when setting breakpoints.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/mnt/H/Misc <span class="o">&gt;</span> strings BombsLanded                                                       1m 49s 
/lib/ld-linux.so.2
libdl.so.2
_ITM_deregisterTMCloneTable
__gmon_start__
_Jv_RegisterClasses
_ITM_registerTMCloneTable
dlsym
libc.so.6
_IO_stdin_used
<span class="nb">exit
</span>strncmp
__isoc99_scanf
puts
<span class="nb">printf
</span>mmap
strlen
memset
getchar
malloc
ptrace
__cxa_finalize
__libc_start_main
free
GLIBC_2.0
GLIBC_2.7
GLIBC_2.1.3
fPf1
fPfP
WVSQ
Y[^_]
UWVS
t<span class="nv">$,</span>U
<span class="o">[</span>^_]
input password: 
Correct password:
Bad luck dude.
strncmp
<span class="p">;</span><span class="k">*</span>2<span class="s2">$"
cccc
g r c
cccc
g j c
</span></code></pre></div></div>

<p>When we run the strings command on the binary, we see some interesting strings such as <code class="language-plaintext highlighter-rouge">mmap</code>, <code class="language-plaintext highlighter-rouge">malloc</code>, <code class="language-plaintext highlighter-rouge">strncmp</code>, and <code class="language-plaintext highlighter-rouge">dlsym</code>. These strings indicate that the symbols and other sections requiring resolving are resolved dynamically, as the presence of <code class="language-plaintext highlighter-rouge">dlsym</code> explicitly confirms.</p>

<p>We also see the strings <code class="language-plaintext highlighter-rouge">input password:</code>, <code class="language-plaintext highlighter-rouge">Correct password:</code>, and <code class="language-plaintext highlighter-rouge">Bad luck dude.</code>, which are important for our understanding of the binary. Note that the colon against <code class="language-plaintext highlighter-rouge">Correct password</code> is peculiar, and we will explore this soon. Additionally, the presence of <code class="language-plaintext highlighter-rouge">scanf</code> when <code class="language-plaintext highlighter-rouge">getchar</code> is already present seems odd for a simple program that just uses stdin once.</p>

<p>On the other hand, there is a problem that a lot of solvers apparently encounter.</p>

<p><img src="./img/elfparser.webp" alt="" /></p>

<p>According to <code class="language-plaintext highlighter-rouge">elfparser</code>, the binary has <code class="language-plaintext highlighter-rouge">ptrace</code> detection enabled.</p>

<p><img src="./img/elfparser_imports.webp" alt="" /></p>

<p>Here, we can see that the function <code class="language-plaintext highlighter-rouge">main</code> is both defined and a global function. In my solution, I did not face any issues with this, but for those who might, here’s a way to bypass it:</p>

<p><img src="./img/ghidra.webp" alt="" /></p>

<p>Here, we can see that the function <code class="language-plaintext highlighter-rouge">ptrace</code> is defined as an external import in Ghidra (you can use tools like IDA Pro, radare2 and Binary Ninja if you want).</p>

<p><img src="./img/refs.webp" alt="" /></p>

<p>On the function itself, right-click and select <code class="language-plaintext highlighter-rouge">Show references to ptrace</code> in the References tab.</p>

<p><img src="./img/locs.webp" alt="" /></p>

<p>You will see that, there is an unconditional call to <code class="language-plaintext highlighter-rouge">ptrace</code> in this case. Double-click and take a look at the disassembly.</p>

<p><img src="./img/patch.webp" alt="" /></p>

<p>Here, originally this instruction was <code class="language-plaintext highlighter-rouge">JNZ</code>, and now we attempt to reassemble it as a <code class="language-plaintext highlighter-rouge">JZ</code> instruction instead. If you are debugging, the value of <code class="language-plaintext highlighter-rouge">EAX</code> after the ptrace call will most certainly be <code class="language-plaintext highlighter-rouge">0xffffffff</code> or -1. Thus, the <code class="language-plaintext highlighter-rouge">CMP</code> instruction will be passed as a check and you will pass the overall <code class="language-plaintext highlighter-rouge">ptrace</code> check.</p>

<p>There are many other ways to bypass this <code class="language-plaintext highlighter-rouge">ptrace</code> check. You could try removing the call to <code class="language-plaintext highlighter-rouge">ptrace</code> altogether by replacing it with <code class="language-plaintext highlighter-rouge">NOPs</code> either in the <code class="language-plaintext highlighter-rouge">ptrace</code> function itself or the <code class="language-plaintext highlighter-rouge">call</code> function. You can even set the value of <code class="language-plaintext highlighter-rouge">EAX</code> accordingly to pass the check while debugging. But it’s easier to just patch the binary instead of doing that every debug session.</p>

<h2 id="decompilation-and-disassembly">Decompilation And Disassembly</h2>

<p>We open up the binary in Ghidra to take a look at the disassembly and its decompilation side by side.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">undefined4</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">param_1</span><span class="p">)</span>

<span class="p">{</span>
  <span class="kt">int</span> <span class="n">iVar1</span><span class="p">;</span>
  <span class="n">undefined4</span> <span class="o">*</span><span class="n">__s</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uVar2</span><span class="p">;</span>
  <span class="n">undefined4</span> <span class="o">*</span><span class="n">puVar3</span><span class="p">;</span>
  <span class="n">undefined4</span> <span class="o">*</span><span class="n">puVar4</span><span class="p">;</span>
  <span class="n">byte</span> <span class="n">bVar5</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">local_24</span><span class="p">;</span>
  
  <span class="n">bVar5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">_DAT_10091348</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">__DT_PLTGOT</span><span class="p">;</span>
  <span class="n">_DAT_1009134c</span> <span class="o">=</span> <span class="n">_DAT_1009134c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">_DAT_10091338</span> <span class="o">=</span> <span class="n">_DAT_10091338</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">_DAT_1009133c</span> <span class="o">=</span> <span class="n">_DAT_1009133c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">_DAT_10091340</span> <span class="o">=</span> <span class="n">_DAT_10091340</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">_DAT_1009133c</span> <span class="o">&lt;</span> <span class="n">_DAT_1009134c</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">param_1</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">__s</span> <span class="o">=</span> <span class="p">(</span><span class="n">undefined4</span> <span class="o">*</span><span class="p">)</span><span class="n">mmap</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x1000</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mh">0x22</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">__s</span><span class="p">,</span><span class="mh">0xc3</span><span class="p">,</span><span class="mh">0x1000</span><span class="p">);</span>
    <span class="o">*</span><span class="n">__s</span> <span class="o">=</span> <span class="n">_DAT_100911a0</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">undefined4</span> <span class="o">*</span><span class="p">)((</span><span class="kt">int</span><span class="p">)</span><span class="n">__s</span> <span class="o">+</span> <span class="mh">0x193</span><span class="p">)</span> <span class="o">=</span> <span class="n">_DAT_10091333</span><span class="p">;</span>
    <span class="n">iVar1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">__s</span> <span class="o">-</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">undefined4</span> <span class="o">*</span><span class="p">)((</span><span class="n">uint</span><span class="p">)(</span><span class="n">__s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xfffffffc</span><span class="p">);</span>
    <span class="n">puVar3</span> <span class="o">=</span> <span class="p">(</span><span class="n">undefined4</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">DAT_100911a0</span> <span class="o">+</span> <span class="o">-</span><span class="n">iVar1</span><span class="p">);</span>
    <span class="n">puVar4</span> <span class="o">=</span> <span class="p">(</span><span class="n">undefined4</span> <span class="o">*</span><span class="p">)((</span><span class="n">uint</span><span class="p">)(</span><span class="n">__s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xfffffffc</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">uVar2</span> <span class="o">=</span> <span class="n">iVar1</span> <span class="o">+</span> <span class="mh">0x197U</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">uVar2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">uVar2</span> <span class="o">=</span> <span class="n">uVar2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">*</span><span class="n">puVar4</span> <span class="o">=</span> <span class="o">*</span><span class="n">puVar3</span><span class="p">;</span>
      <span class="n">puVar3</span> <span class="o">=</span> <span class="n">puVar3</span> <span class="o">+</span> <span class="p">(</span><span class="n">uint</span><span class="p">)</span><span class="n">bVar5</span> <span class="o">*</span> <span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">puVar4</span> <span class="o">=</span> <span class="n">puVar4</span> <span class="o">+</span> <span class="p">(</span><span class="n">uint</span><span class="p">)</span><span class="n">bVar5</span> <span class="o">*</span> <span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">local_24</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">local_24</span> <span class="o">&lt;</span> <span class="mh">0x197</span><span class="p">;</span> <span class="n">local_24</span> <span class="o">=</span> <span class="n">local_24</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">*</span><span class="p">(</span><span class="n">byte</span> <span class="o">*</span><span class="p">)((</span><span class="kt">int</span><span class="p">)</span><span class="n">__s</span> <span class="o">+</span> <span class="n">local_24</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">byte</span> <span class="o">*</span><span class="p">)((</span><span class="kt">int</span><span class="p">)</span><span class="n">__s</span> <span class="o">+</span> <span class="n">local_24</span><span class="p">)</span> <span class="o">^</span> <span class="mi">99</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">code</span> <span class="o">*</span><span class="p">)</span><span class="n">__s</span><span class="p">)();</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">__s</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mh">0x197</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;</span> <span class="n">param_1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x10090c70</span><span class="p">);</span> <span class="c1">//input password:</span>
    <span class="n">iVar1</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="n">iVar1</span> <span class="o">==</span> <span class="sc">'X'</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">code</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xc3</span><span class="p">)();</span>
      <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="mh">0x10090c81</span><span class="p">);</span> <span class="c1">//Correct password:</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">puts</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x10090c93</span><span class="p">);</span> <span class="c1">//Bad luck dude.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is the main function as decompiled by Ghidra. Here is where the weirdness happens. As you can see, it’s not an ordinary password checker. It has something else going on altogether before it. Even the password checking part is odd. Furthermore, none of the variables above are used in the password checker and is completely separate.</p>

<p>First, it prints out <code class="language-plaintext highlighter-rouge">input password: </code> and takes input via getchar. It checks whether the first character of the input we give is <code class="language-plaintext highlighter-rouge">X</code> or not. If it is, a function with the address <code class="language-plaintext highlighter-rouge">c3</code> is called and <code class="language-plaintext highlighter-rouge">Correct password: </code> is passed as an argument to <code class="language-plaintext highlighter-rouge">scanf</code>. This makes no sense and there is no way to retrieve the password here. I spent at least 4–5 hours tinkering with this section of <code class="language-plaintext highlighter-rouge">main</code> and got nowhere. It is the most interesting rabbit hole I have seen in my short reverse-engineering journey.</p>

<p>What to do then?</p>

<p>Well, we can try to focus on the code above then since there is no other function with code that may be relevant. To do that, we must first pass the if condition <code class="language-plaintext highlighter-rouge">if ((_DAT_1009133c &lt; _DAT_1009134c) &amp;&amp; (param_1 &lt; 5))</code>. In my experience, it has always been safer to just switch up the conditional jumps to their opposite counterparts. Which is exactly what we will do. Alternatively, we can try to change the values of the registers in <code class="language-plaintext highlighter-rouge">gdb-pwndbg</code> or patch the binary to always fulfill the condition. Or we can remove the condition altogether.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">080489</span><span class="n">b8</span> <span class="mi">39</span> <span class="n">c1</span>           <span class="n">CMP</span>        <span class="n">ECX</span><span class="p">,</span><span class="n">EAX</span>
<span class="mi">080489</span><span class="n">ba</span> <span class="mi">77</span> <span class="mo">05</span>           <span class="n">JA</span>         <span class="n">LAB_080489c1</span>
<span class="mi">080489</span><span class="n">bc</span> <span class="mi">83</span> <span class="mi">3</span><span class="n">a</span> <span class="mo">04</span>        <span class="n">CMP</span>        <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">EDX</span><span class="p">]</span><span class="o">=&gt;</span><span class="n">param_1</span><span class="p">,</span><span class="mh">0x4</span>
<span class="mi">080489</span><span class="n">bf</span> <span class="mi">7</span><span class="n">f</span> <span class="mi">57</span>           <span class="n">JG</span>         <span class="n">LAB_08048a18</span>
</code></pre></div></div>

<p>This part of the assembly code concerns with the check that needs to be passed. To do this, we will switch from <code class="language-plaintext highlighter-rouge">JA</code> to <code class="language-plaintext highlighter-rouge">JBE</code> and from <code class="language-plaintext highlighter-rouge">JG</code> to <code class="language-plaintext highlighter-rouge">JLE</code>. This should work because the values in the registers before the <code class="language-plaintext highlighter-rouge">CMP</code> instruction always seem to be the same, so patching the code would allow it to pass the checks.</p>

<p><img src="./img/patched.webp" alt="" /></p>

<p>This is the patched code. Now, let’s jump to the CMP directly by breaking at 0x80489b8.</p>

<p><img src="./img/bp.webp" alt="" /></p>

<p>We break at the <code class="language-plaintext highlighter-rouge">CMP</code> instruction successfully.</p>

<p><img src="./img/bypasscheck.webp" alt="" /></p>

<p>Stepping through the code, we successfully bypass the check as seen above. After bypassing the check, we step through the code until we see this loop -</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="mh">0x8048a9a</span>    <span class="n">movzx</span>  <span class="n">edx</span><span class="p">,</span> <span class="n">byte</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">edx</span><span class="p">]</span>
   <span class="mh">0x8048a9d</span>    <span class="n">xor</span>    <span class="n">edx</span><span class="p">,</span> <span class="mh">0x63</span>
   <span class="mh">0x8048aa0</span>    <span class="n">mov</span>    <span class="n">byte</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">eax</span><span class="p">],</span> <span class="n">dl</span>
   <span class="mh">0x8048aa2</span>    <span class="n">add</span>    <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x1c</span><span class="p">],</span> <span class="mi">1</span>
   <span class="mh">0x8048aa6</span>    <span class="n">mov</span>    <span class="n">eax</span><span class="p">,</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x1c</span><span class="p">]</span>
 <span class="err">►</span> <span class="mh">0x8048aa9</span>    <span class="n">cmp</span>    <span class="n">eax</span><span class="p">,</span> <span class="mh">0x196</span>
   <span class="mh">0x8048aae</span>    <span class="n">jbe</span>    <span class="mh">0x8048a8a</span>                     <span class="o">&lt;</span><span class="mh">0x8048a8a</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>At the <code class="language-plaintext highlighter-rouge">jbe</code> instruction, we will loop a couple of times. So, to end the loop, we will use <code class="language-plaintext highlighter-rouge">x/3i $eip</code> to set a breakpoint on the address after `jbe.</p>

<p><img src="./img/eip.webp" alt="" /></p>

<p>As you can see that worked perfectly.</p>

<p><img src="./img/calleax.webp" alt="" /></p>

<p>And then, three instructions after <code class="language-plaintext highlighter-rouge">JBE</code>, we’ll see a <code class="language-plaintext highlighter-rouge">CALL EAX</code>. This is where the flag is hidden. To step into this, we’ll use the <code class="language-plaintext highlighter-rouge">si</code> (step into) command.</p>

<p><img src="./img/manymovs.webp" alt="" /></p>

<p>As you can see, there are multiple <code class="language-plaintext highlighter-rouge">MOV</code> instructions done with a couple of hex characters. There is a high likelihood of this having something to do with our flag.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="mh">0xf7fc000a</span>    <span class="n">mov</span>    <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x14</span><span class="p">],</span> <span class="mh">0x6c333374</span>
   <span class="mh">0xf7fc0011</span>    <span class="n">mov</span>    <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x5c</span><span class="p">],</span> <span class="mh">0x647f6573</span>
   <span class="mh">0xf7fc0018</span>    <span class="n">mov</span>    <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x58</span><span class="p">],</span> <span class="mh">0x786f7c6f</span>
   <span class="mh">0xf7fc001f</span>    <span class="n">mov</span>    <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x54</span><span class="p">],</span> <span class="mh">0x6463656d</span>
   <span class="mh">0xf7fc0026</span>    <span class="n">mov</span>    <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x50</span><span class="p">],</span> <span class="mh">0x6c657e6d</span>
   <span class="mh">0xf7fc002d</span>    <span class="n">mov</span>    <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x4c</span><span class="p">],</span> <span class="mh">0x676e6463</span>
   <span class="mh">0xf7fc003a</span>    <span class="n">mov</span>    <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x6d</span><span class="p">],</span> <span class="mh">0x61647a7d</span>
   <span class="mh">0xf7fc0041</span>    <span class="n">mov</span>    <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x69</span><span class="p">],</span> <span class="mh">0x75643460</span>
   <span class="mh">0xf7fc0048</span>    <span class="n">mov</span>    <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x65</span><span class="p">],</span> <span class="mh">0x7b636767</span>
   <span class="mh">0xf7fc004f</span>    <span class="n">mov</span>    <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">ebp</span> <span class="o">-</span> <span class="mh">0x61</span><span class="p">],</span> <span class="mh">0x342e7066</span>
</code></pre></div></div>

<p>These are all the instructions featuring a series of hex strings.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">pwn</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">l</span><span class="o">=</span><span class="p">[</span><span class="mh">0x6c333374</span><span class="p">,</span><span class="mh">0x647f6573</span><span class="p">,</span><span class="mh">0x786f7c6f</span><span class="p">,</span><span class="mh">0x6463656d</span><span class="p">,</span><span class="mh">0x6c657e6d</span><span class="p">,</span><span class="mh">0x676e6463</span><span class="p">,</span><span class="mh">0x61647a7d</span><span class="p">,</span><span class="mh">0x75643460</span><span class="p">,</span><span class="mh">0x7b636767</span><span class="p">,</span><span class="mh">0x342e7066</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="n">pwn</span><span class="p">.</span><span class="n">p32</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]))</span>
<span class="n">t33lsedo</span><span class="o">|</span><span class="n">oxmecdm</span><span class="o">~</span><span class="n">elcdng</span><span class="p">}</span><span class="n">zda</span><span class="err">`</span><span class="mi">4</span><span class="n">duggc</span><span class="p">{</span><span class="n">fp</span><span class="p">.</span><span class="mi">4</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Using <code class="language-plaintext highlighter-rouge">pwntools</code>, we try to decrypt these hex characters into strings and we get a row of nonsense.</p>

<p>As it turns out, this string (in little-endian) is looped through and eventually produces the string <code class="language-plaintext highlighter-rouge">input password: </code></p>

<p><img src="./img/inputpass.webp" alt="" /></p>

<p>We can see that happening above here.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mo">00</span><span class="o">:</span><span class="mo">0000</span><span class="err">│</span> <span class="n">esp</span> <span class="mh">0xffffceb0</span> <span class="err">—▸</span> <span class="mh">0xffffcedb</span> <span class="err">◂—</span> <span class="err">'</span><span class="n">input</span> <span class="n">passw</span><span class="p">{</span><span class="n">fp</span><span class="p">.</span><span class="mi">4</span><span class="err">'</span>
<span class="mo">01</span><span class="o">:</span><span class="mo">0004</span><span class="err">│</span>     <span class="mh">0xffffceb4</span> <span class="err">◂—</span> <span class="mh">0x3055e4</span>
<span class="mo">02</span><span class="o">:</span><span class="mo">000</span><span class="mi">8</span><span class="err">│</span>     <span class="mh">0xffffceb8</span> <span class="err">—▸</span> <span class="mh">0xf7fc1958</span> <span class="err">—▸</span> <span class="mh">0xf7ffdbac</span> <span class="err">—▸</span> <span class="mh">0xf7fc1a94</span> <span class="err">—▸</span> <span class="mh">0xf7ffda40</span> <span class="err">◂—</span> <span class="p">...</span>
<span class="mo">03</span><span class="o">:</span><span class="mo">000</span><span class="n">c</span><span class="err">│</span>     <span class="mh">0xffffcebc</span> <span class="err">—▸</span> <span class="mh">0xffffcf30</span> <span class="err">—▸</span> <span class="mh">0xf7d77ad6</span> <span class="p">(</span><span class="n">__memset_sse2_rep</span><span class="o">+</span><span class="mi">294</span><span class="p">)</span> <span class="err">◂—</span> <span class="n">add</span> <span class="n">ebx</span><span class="p">,</span> <span class="mh">0xa551e</span>
<span class="mo">04</span><span class="o">:</span><span class="mo">0010</span><span class="err">│</span>     <span class="mh">0xffffcec0</span> <span class="err">—▸</span> <span class="mh">0xffffcf34</span> <span class="err">◂—</span> <span class="mh">0x6c333374</span> <span class="p">(</span><span class="err">'</span><span class="n">t33l</span><span class="err">'</span><span class="p">)</span>
<span class="mo">05</span><span class="o">:</span><span class="mo">0014</span><span class="err">│</span>     <span class="mh">0xffffcec4</span> <span class="err">—▸</span> <span class="mh">0xf7fd2fce</span> <span class="p">(</span><span class="n">_dl_lookup_symbol_x</span><span class="o">+</span><span class="mi">302</span><span class="p">)</span> <span class="err">◂—</span> <span class="n">add</span> <span class="n">esp</span><span class="p">,</span> <span class="mh">0x30</span>
<span class="mo">06</span><span class="o">:</span><span class="mo">001</span><span class="mi">8</span><span class="err">│</span>     <span class="mh">0xffffcec8</span> <span class="err">—▸</span> <span class="mh">0xf7c09a54</span> <span class="err">◂—</span> <span class="mh">0x61ab</span>
<span class="mo">07</span><span class="o">:</span><span class="mo">001</span><span class="n">c</span><span class="err">│</span>     <span class="mh">0xffffcecc</span> <span class="err">—▸</span> <span class="mh">0xffffcf34</span> <span class="err">◂—</span> <span class="mh">0x6c333374</span> <span class="p">(</span><span class="err">'</span><span class="n">t33l</span><span class="err">'</span><span class="p">)</span>
</code></pre></div></div>

<p>In the stack above, we also see remnants of the string we converted using python. Thus, it’s possible that when the instruction <code class="language-plaintext highlighter-rouge">strncmp</code> is run against our input, a similar decryption loop occurs and thus we will be able to see the flag.</p>

<p><img src="./img/testeax.webp" alt="" /></p>

<p>When you reach this part of the execution, if <code class="language-plaintext highlighter-rouge">EAX</code> is not equal to <code class="language-plaintext highlighter-rouge">0x0</code>, the program eventually exits. However, when debugging, we can set <code class="language-plaintext highlighter-rouge">EAX</code> to <code class="language-plaintext highlighter-rouge">0x0</code> by using the command <code class="language-plaintext highlighter-rouge">set $eax=0x0</code>. Once this is done, you will be greeted with the result.</p>

<p>We are on the right track, but we are skipping a certain part of the code.</p>

<p><img src="./img/calleax2.webp" alt="" /></p>

<p>This is the only instruction that looked suspicious enough before the checking (and printing <code class="language-plaintext highlighter-rouge">you win</code> if you get it right). On stepping in a few instructions inside the <code class="language-plaintext highlighter-rouge">CALL EAX</code>, we see the following -</p>

<p><img src="./img/dlsym.webp" alt="" /></p>

<p>Now, we know we are on the right track since we see that <code class="language-plaintext highlighter-rouge">strncmp</code> is now resolved using <code class="language-plaintext highlighter-rouge">dlsym</code>. Normally, in <code class="language-plaintext highlighter-rouge">gdb-pwndbg</code> you can see the arguments fed into <code class="language-plaintext highlighter-rouge">strncmp</code> but here we can’t since this is just a dynamically linked symbol within the <code class="language-plaintext highlighter-rouge">CALL EAX</code>. This tells me that the <code class="language-plaintext highlighter-rouge">CALL EAX</code> done is actually running <code class="language-plaintext highlighter-rouge">strncmp</code>. Thus, let’s step over the call <code class="language-plaintext highlighter-rouge">dlsym</code> and see what happens.</p>

<p><img src="./img/strncmp.webp" alt="" /></p>

<p>After stepping in with <code class="language-plaintext highlighter-rouge">ni</code> a couple of times, we start to see interesting things. Take a look at <code class="language-plaintext highlighter-rouge">$esp+4</code>. We see a <code class="language-plaintext highlighter-rouge">y</code>. Let’s step in some more.</p>

<p><img src="./img/youne.webp" alt="" /></p>

<p>We are starting to see something interesting. After stepping enough times we find the password.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mo">00</span><span class="o">:</span><span class="mo">0000</span><span class="err">│</span> <span class="n">esp</span> <span class="mh">0xffffce80</span> <span class="err">—▸</span> <span class="mh">0xffffcf02</span> <span class="err">◂—</span> <span class="err">'</span><span class="n">asdasdadsasda</span><span class="err">'</span>
<span class="mo">01</span><span class="o">:</span><span class="mo">0004</span><span class="err">│</span>     <span class="mh">0xffffce84</span> <span class="err">—▸</span> <span class="mh">0x804a9c0</span> <span class="err">◂—</span> <span class="err">'</span><span class="n">younexxxxxxxx</span><span class="err">'</span>
<span class="mo">02</span><span class="o">:</span><span class="mo">000</span><span class="mi">8</span><span class="err">│</span>     <span class="mh">0xffffce88</span> <span class="err">◂—</span> <span class="mh">0x15</span>
<span class="mo">03</span><span class="o">:</span><span class="mo">000</span><span class="n">c</span><span class="err">│</span>     <span class="mh">0xffffce8c</span> <span class="err">—▸</span> <span class="mh">0xf7c53b25</span> <span class="p">(</span><span class="n">__isoc99_scanf</span><span class="o">+</span><span class="mi">37</span><span class="p">)</span> <span class="err">◂—</span> <span class="n">add</span> <span class="n">esp</span><span class="p">,</span> <span class="mh">0x1c</span>
<span class="mo">04</span><span class="o">:</span><span class="mo">0010</span><span class="err">│</span>     <span class="mh">0xffffce90</span> <span class="err">—▸</span> <span class="mh">0xf7e1d620</span> <span class="p">(</span><span class="n">_IO_2_1_stdin_</span><span class="p">)</span> <span class="err">◂—</span> <span class="mh">0xfbad2288</span>
<span class="mo">05</span><span class="o">:</span><span class="mo">0014</span><span class="err">│</span>     <span class="mh">0xffffce94</span> <span class="err">—▸</span> <span class="mh">0x804a9c0</span> <span class="err">◂—</span> <span class="err">'</span><span class="n">younexxxxxxxx</span><span class="err">'</span>
<span class="mo">06</span><span class="o">:</span><span class="mo">001</span><span class="mi">8</span><span class="err">│</span>     <span class="mh">0xffffce98</span> <span class="err">—▸</span> <span class="mh">0xf7d8a1e0</span> <span class="p">(</span><span class="n">__strncmp_sse4_2</span><span class="p">)</span> <span class="err">◂—</span> <span class="n">push</span> <span class="n">ebp</span>
<span class="mo">07</span><span class="o">:</span><span class="mo">001</span><span class="n">c</span><span class="err">│</span>     <span class="mh">0xffffce9c</span> <span class="err">◂—</span> <span class="mh">0x15</span>
</code></pre></div></div>

<p>Here, I’ve censored the password, but you can see it in the stack if you try this method out for yourself.</p>

<p>The final flag is <code class="language-plaintext highlighter-rouge">HTB{&lt;the password you find on the stack&gt;}</code>.</p>

<p>I still couldn’t figure out where this piece of code came from. I tried searching for cross-references of functions like <code class="language-plaintext highlighter-rouge">dlsym</code>, <code class="language-plaintext highlighter-rouge">strncmp</code>, and <code class="language-plaintext highlighter-rouge">strlen</code>, but all I found was a reference to an unknown code unit. This means that the code we just looked at was created at runtime and can’t be found in static analysis. Extremely interesting puzzle and I learned a lot about anti-reversing/debugging and how difficult it can be to bypass such measures.</p>

<p>I hope you learned something from this blog :)</p>

<p>Thank you for reading.</p>


    </section>
  </div>
</body>

</html>
